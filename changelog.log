# Changelog

## 2025-12-05 (Gemini) - UI Refinements & Final Cleanup

### UI Improvements
- **Spell Calculator Layout:** Refactored the "Additional Scaling" UI for spells. Scaling components are now visually nested within their parent spell group, using a new `.spell-source-group` container to improve clarity and usability.

### Code Quality & Cleanup
- **CSS Cleanup:** Audited and removed several unused and redundant CSS rules from `style.css`, including obsolete selectors like `.input-group` and simplified complex selectors for section headlines.
- **JavaScript Polish:**
    - Removed the obsolete `applyValueChange` method from `WeaponCalculator` and streamlined the undo/redo logic in `script.js` to use `setState` directly.
    - Refined the `addSpellDamageRow` function in `SpellCalculator` to no longer require a dummy event object for programmatic calls.
    - Removed all leftover `console.log` statements from the codebase.

### Bug Fixes
- **Spell Row Recreation:** Fixed a bug in `SpellCalculator` where undoing the deletion of a spell row would not correctly recreate its full visual container, leading to layout issues.

---

## 2025-12-05 (Gemini) - Architectural Refactor & Feature Polish

### Architectural Overhaul
- **Decoupled HTML & JS:** Replaced all `id`-based DOM selection with a more robust `data-element` attribute pattern across all calculators, making the codebase less brittle and easier to maintain.
- **In-Memory State Management:** Refactored both `WeaponCalculator` and `SpellCalculator` to use an internal `state` object as the single source of truth. All calculations now read from this state, completely decoupling the application logic from the DOM.
- **Scoped Event Listeners:** Removed the global 'Enter' key listener and replaced it with a targeted listener on the active calculator container, preventing unintended side effects.
- **Comprehensive Undo/Redo:** The undo/redo system is now fully implemented. It correctly handles adding and removing dynamic rows (e.g., "Unscaled Damage", "Spell Power Profiles") in both calculators, in addition to value changes and set management.

### Feature Enhancements
- **Spell Calculator Summary:** The "Summary Export" for spell sets has been completely overhauled. It now provides a detailed, human-readable breakdown of Metamagics, Boosts, all Spell Power Profiles, and all Spell Damage Sources, including their additional scaling components.

### Bug Fixes & Code Quality
- **Weapon Calculator Inputs:** Fixed a critical bug where weapon set inputs were unresponsive due to missing event listeners after a refactor.
- **Code Consistency:** Ensured both `WeaponCalculator` and `SpellCalculator` consistently use the new state management pattern, removing redundant DOM-reading methods.
- **Event Handling:** Refined the `BaseCalculator` class to delegate event listener attachment to its children, clarifying the code's control flow.
- **Undo/Redo Reliability:** Corrected a minor bug in the row recreation logic to ensure perfect state restoration during undo/redo operations.

### File-Specific Changes
- **script.js:** Implemented scoped 'Enter' key listener, updated undo/redo logic for dynamic rows, and overhauled the `getSetsAsSummary` function.
- **WeaponCalculator.js & SpellCalculator.js:** Integrated in-memory state, implemented `handleInputChange`, and added methods to support dynamic row changes for the undo/redo system.
- **BaseCalculator.js:** Simplified by removing base event listener implementation.
- **utils.js & index.html:** Updated to support the `data-element` attribute pattern.
